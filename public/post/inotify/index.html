<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Linux Inotify 机制简介 | Mehameha</title>
    <meta property="og:title" content="Linux Inotify 机制简介 - Mehameha">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-05-25T19:49:39&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-05-25T19:49:39&#43;08:00'>
        
    <meta name="Keywords" content="">
    <meta name="description" content="Linux Inotify 机制简介">
        <meta name="author" content="Scott">
        
    <meta property="og:url" content="/post/inotify/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    


    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="">
                        Mehameha
                    </a>
                
                
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="">首页</a>
                    
                    <a  href="/archives/" title="归档">归档</a>
                    
                    <a  href="/about/" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">Linux Inotify 机制简介</h1>
        </header>
        <date class="post-meta meta-date">
            2020年5月25日
        </date>
        
        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span><span>
                    阅读</span></span>
        </div>
        
        
        <div class="post-content">
            <p>Inotify 是一种强大的、细粒度的、异步的文件系统事件监控机制， <strong>Linux 内核从 2.6.13 起，加入了 Inotify 支持</strong>。</p>
<h3 id="一inotify-机制介绍">一、Inotify 机制介绍</h3>
<p>Inotify 实际是一种事件驱动机制，它为应用程序监控文件系统事件提供了实时响应事件的机制，而无须通过诸如 cron 等的轮询机制来获取事件。cron 等机制不仅无法做到实时性，而且消耗大量系统资源。相比之下，<strong>inotify 基于事件驱动，可以做到对事件处理的实时响应，也没有轮询造成的系统资源消耗</strong>，是非常自然的事件通知接口，也与自然世界事件机制相符合。</p>
<p><strong>实现 inotify 机制的常用软件有：</strong></p>
<ul>
<li><code>inotify-tools</code></li>
<li><code>sersync</code></li>
<li><code>lrsyncd</code></li>
</ul>
<p>通过 Inotify 可以监控文件系统中添加、删除，修改、移动等各种事件，利用这个内核接口，第三方软件就可以监控文件系统下文件的各种变化情况，而 <code> inotify-tools</code> 正是实施这样监控的软件。以下介绍 <code> inotify-tools</code> 的安装与应用。</p>
<h3 id="二安装-inotify-tools">二、安装 inotify-tools</h3>
<p>CentOS:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">yum install -y inotify-tools
</code></pre></div><p>Ubuntu:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">apt-get install inotify-tools
</code></pre></div><h3 id="三inotify-tools-介绍">三、inotify-tools 介绍</h3>
<p><code>inotify-tools</code> 主要包括两个命令：<code>inotifywait</code> 、<code>inotifywatch</code>。</p>
<ul>
<li><code>inotifywait</code> 在被监控的文件或目录上等待特定文件系统事件（<code>open</code>/<code>close</code>/<code>delete</code>等）发生，执行后处于阻塞状态，适合在shell脚本中使用；</li>
<li><code>inotifywatch</code> 收集被监控的文件系统使用的统计数据，指文件系统事件发生的次数统计。</li>
</ul>
<p>文件监控主要依赖 <code>inotifywatch</code>。以下是 <code>inotifywatch</code> 的帮助信息：</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ubuntu@VM-0-3-ubuntu:~$ inotifywait -h
inotifywait 3.14
Wait <span style="color:#00a8c8">for</span> a particular event on a file or <span style="color:#111">set</span> of files.
Usage: inotifywait <span style="color:#f92672">[</span> options <span style="color:#f92672">]</span> file1 <span style="color:#f92672">[</span> file2 <span style="color:#f92672">]</span> <span style="color:#f92672">[</span> file3 <span style="color:#f92672">]</span> <span style="color:#f92672">[</span> ... <span style="color:#f92672">]</span>
Options:
	-h<span style="color:#111">|</span>--help     	Show this <span style="color:#111">help</span> text.
	@&lt;file&gt;       	Exclude the specified file from being watched.
	--exclude &lt;pattern&gt;
	              	Exclude all events on files matching the
	              	extended regular expression &lt;pattern&gt;.
	--excludei &lt;pattern&gt;
	              	Like --exclude but <span style="color:#00a8c8">case</span> insensitive.
	-m<span style="color:#111">|</span>--monitor  	Keep listening <span style="color:#00a8c8">for</span> events forever.  Without
	              	this option, inotifywait will <span style="color:#111">exit</span> after one
	              	event is received.
	-d<span style="color:#111">|</span>--daemon   	Same as --monitor, except run in the background
	              	logging events to a file specified by --outfile.
	              	Implies --syslog.
	-r<span style="color:#111">|</span>--recursive	Watch directories recursively.
	--fromfile &lt;file&gt;
	              	Read files to watch from &lt;file&gt; or <span style="color:#d88200">`</span>-<span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#00a8c8">for</span> stdin.
	-o<span style="color:#111">|</span>--outfile &lt;file&gt;
	              	Print events to &lt;file&gt; rather than stdout.
	-s<span style="color:#111">|</span>--syslog   	Send errors to syslog rather than stderr.
	-q<span style="color:#111">|</span>--quiet    	Print less <span style="color:#f92672">(</span>only print events<span style="color:#f92672">)</span>.
	-qq           	Print nothing <span style="color:#f92672">(</span>not even events<span style="color:#f92672">)</span>.
	--format &lt;fmt&gt;	Print using a specified printf-like format
	              	string<span style="color:#111">;</span> <span style="color:#111">read</span> the man page <span style="color:#00a8c8">for</span> more details.
	--timefmt &lt;fmt&gt;	strftime-compatible format string <span style="color:#00a8c8">for</span> use with
	              	%T in --format string.
	-c<span style="color:#111">|</span>--csv      	Print events in CSV format.
	-t<span style="color:#111">|</span>--timeout &lt;seconds&gt;
	              	When listening <span style="color:#00a8c8">for</span> a single event, <span style="color:#111">time</span> out after
	              	waiting <span style="color:#00a8c8">for</span> an event <span style="color:#00a8c8">for</span> &lt;seconds&gt; seconds.
	              	If &lt;seconds&gt; is 0, inotifywait will never <span style="color:#111">time</span> out.
	-e<span style="color:#111">|</span>--event &lt;event1&gt; <span style="color:#f92672">[</span> -e<span style="color:#111">|</span>--event &lt;event2&gt; ... <span style="color:#f92672">]</span>
		Listen <span style="color:#00a8c8">for</span> specific event<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>.  If omitted, all events are
		listened <span style="color:#00a8c8">for</span>.

Exit status:
	<span style="color:#ae81ff">0</span>  -  An event you asked to watch <span style="color:#00a8c8">for</span> was received.
	<span style="color:#ae81ff">1</span>  -  An event you did not ask to watch <span style="color:#00a8c8">for</span> was received
	      <span style="color:#f92672">(</span>usually delete_self or unmount<span style="color:#f92672">)</span>, or some error occurred.
	<span style="color:#ae81ff">2</span>  -  The --timeout option was given and no events occurred
	      in the specified interval of time.

Events:
	access		file or directory contents were <span style="color:#111">read</span>
	modify		file or directory contents were written
	attrib		file or directory attributes changed
	close_write	file or directory closed, after being opened in
	           	writable mode
	close_nowrite	file or directory closed, after being opened in
	           	read-only mode
	close		file or directory closed, regardless of read/write mode
	open		file or directory opened
	moved_to	file or directory moved to watched directory
	moved_from	file or directory moved from watched directory
	move		file or directory moved to or from watched directory
	create		file or directory created within watched directory
	delete		file or directory deleted within watched directory
	delete_self	file or directory was deleted
	unmount		file system containing file or directory unmounted
</code></pre></div><h3 id="四inotify-tools-应用">四、inotify-tools 应用</h3>
<p>监听<code>/opt/blog/post</code> 目录下的文件变化，在发生指定的事件时（<code>modify</code>, <code>create</code>, <code>move</code>, <code>delete</code>）调用 <code>hugo</code> 编译。</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#00a8c8">while</span> true<span style="color:#111">;</span> <span style="color:#00a8c8">do</span>
    <span style="color:#00a8c8">if</span> <span style="color:#f92672">[[</span> <span style="color:#d88200">&#34;</span><span style="color:#00a8c8">$(</span>inotifywatch -r -t <span style="color:#ae81ff">5</span> -e modify,create,move,delete /opt/blog/post 2&gt;<span style="color:#111">&amp;</span>1<span style="color:#00a8c8">)</span><span style="color:#d88200">&#34;</span> <span style="color:#f92672">=</span>~ filename <span style="color:#f92672">]]</span><span style="color:#111">;</span> <span style="color:#00a8c8">then</span>
	<span style="color:#111">cd</span> /opt/blog<span style="color:#111">;</span>
    	hugo<span style="color:#111">;</span>
    <span style="color:#00a8c8">fi</span><span style="color:#111">;</span>
<span style="color:#00a8c8">done</span>
</code></pre></div><p>上述命令可以通过 <code>nohup xxx.sh &amp;</code> 方式在后台长期执行。其中 <code>xxx.sh</code> 的内容就是上述命令。</p>
        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="">Scott</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="/post/inotify/">/post/inotify/</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/intellij-google-code-style-config/">Intellij IDEA 配置 Google Code Style</a></li>
        
        <li><a href="/post/ubuntu-apt-change-mirror/">Ubuntu apt 国内镜像站</a></li>
        
        <li><a href="/post/linux-port/">查看Linux端口使用情况</a></li>
        
        <li><a href="/post/linux-version/">查看Linux版本信息</a></li>
        
        <li><a href="/post/linux-influxdb-install/">在 Red Hat / CentOS 上安装 InfluxDB</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='/tags/Linux'>Linux</a></li>
                
                <li><a href='/tags/%E5%B7%A5%E5%85%B7'>工具</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
</div>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="/post/quanxue/" title="劝学">劝学</a>
    </li>
    
    <li>
        <a href="/post/git-branch/" title="Git 分支管理">Git 分支管理</a>
    </li>
    
    <li>
        <a href="/post/tail-latency/" title="高并发系统中的尾延迟">高并发系统中的尾延迟</a>
    </li>
    
    <li>
        <a href="/post/inotify/" title="Linux Inotify 机制简介">Linux Inotify 机制简介</a>
    </li>
    
    <li>
        <a href="/post/numpy-excrise-numpy/" title="101 个 NumPy 数据分析练习（1～20）">101 个 NumPy 数据分析练习（1～20）</a>
    </li>
    
    <li>
        <a href="/post/maven-deploy-plugin/" title="Maven Deploy Plugin 使用方法">Maven Deploy Plugin 使用方法</a>
    </li>
    
    <li>
        <a href="/post/intellij-google-code-style-config/" title="Intellij IDEA 配置 Google Code Style">Intellij IDEA 配置 Google Code Style</a>
    </li>
    
    <li>
        <a href="/post/mysql-innodb-transaction/" title="MySQL 事务处理简介">MySQL 事务处理简介</a>
    </li>
    
    <li>
        <a href="/post/java-basic-wiki/" title="Java 基础知识总结">Java 基础知识总结</a>
    </li>
    
    <li>
        <a href="/post/microservice-manage/" title="微服务架构体系治理">微服务架构体系治理</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="/tags/AMQP/">AMQP</a>
    
    <a href="/tags/HTML/">HTML</a>
    
    <a href="/tags/InfluxDB/">InfluxDB</a>
    
    <a href="/tags/InnoDB/">InnoDB</a>
    
    <a href="/tags/JMX/">JMX</a>
    
    <a href="/tags/JVM/">JVM</a>
    
    <a href="/tags/Java/">Java</a>
    
    <a href="/tags/Linux/">Linux</a>
    
    <a href="/tags/Lock/">Lock</a>
    
    <a href="/tags/Maven/">Maven</a>
    
    <a href="/tags/MySQL/">MySQL</a>
    
    <a href="/tags/Numpy/">Numpy</a>
    
    <a href="/tags/OpenCV/">OpenCV</a>
    
    <a href="/tags/Python/">Python</a>
    
    <a href="/tags/data/">data</a>
    
    <a href="/tags/dubbo/">dubbo</a>
    
    <a href="/tags/git/">git</a>
    
    <a href="/tags/groovy/">groovy</a>
    
    <a href="/tags/Java/">Java</a>
    
    <a href="/tags/scikit-learn/">scikit-learn</a>
    
    <a href="/tags/servlet/">servlet</a>
    
    <a href="/tags/spring/">spring</a>
    
    <a href="/tags/ubuntu/">ubuntu</a>
    
    <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a>
    
    <a href="/tags/%E5%8D%8F%E8%AE%AE/">协议</a>
    
    <a href="/tags/%E5%B7%A5%E5%85%B7/">工具</a>
    
    <a href="/tags/%E6%96%87%E5%8F%B2/">文史</a>
    
    <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a>
    
    <a href="/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/">架构设计</a>
    
    <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a>
    
    <a href="/tags/%E7%AE%97%E6%B3%95/">算法</a>
    
    <a href="/tags/%E7%AE%A1%E7%90%86/">管理</a>
    
    <a href="/tags/%E7%BD%91%E7%BB%9C/">网络</a>
    
    <a href="/tags/%E9%AB%98%E5%B9%B6%E5%8F%91/">高并发</a>
    
    <a href="/tags/%E9%AC%BC%E8%B0%B7%E5%AD%90/">鬼谷子</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div class="container">
        &copy; 2020 <a href="">Mehameha By Scott</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/flysnow-org/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.2.8/raphael.min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/flowchart/1.12.2/flowchart.min.js" crossorigin="anonymous"></script>
        <script>(function () {
                if (!window.flowchart) return;
                const blocks = document.querySelectorAll('pre code.language-flowchart, pre code.language-flow');
                for (let i = 0; i < blocks.length; i++) {
                    const block = blocks[i];
                    const rootElement = block.parentNode;
                    const container = document.createElement('div');
                    const id = `js-flowchart-diagrams-${i}`;
                    container.id = id;
                    container.className = 'align-center';
                    container.setAttribute("style", "overFlow-x:auto");
                    rootElement.parentNode.replaceChild(container, rootElement);
                    const diagram = flowchart.parse(block.childNodes[0].nodeValue);
                    diagram.drawSVG(id, window.flowchartDiagramsOptions ? window.flowchartDiagramsOptions : {});
                }
            })();
        </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/webfont/1.6.28/webfontloader.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg-min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js" crossorigin="anonymous"></script>
        <script>(function () {
            if (!window.Diagram) return;
            const blocks = document.querySelectorAll('pre code.language-sequence');
            for (let i = 0; i < blocks.length; i++) {
                const block = blocks[i];
                
                const rootElement = block.parentNode;
                const container = document.createElement('div');
                const id = `js-sequence-diag-${i}`;
                container.id = id;
                container.className = 'align-center';
                container.setAttribute("style", "overFlow-x:auto");
                rootElement.parentNode.replaceChild(container, rootElement);

                const diagram = Diagram.parse(block.childNodes[0].nodeValue);
                diagram.drawSVG(id, window.sequenceDiagramsOptions
                    ? window.sequenceDiagramsOptions
                    : { theme: 'simple' });
            }
        })();
        </script><script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>



    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




</body>

</html>